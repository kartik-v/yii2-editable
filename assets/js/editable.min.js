/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.3
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},n=function(t,i){this.$container=e(t),this.init(i),this.listen()};n.prototype={constructor:n,init:function(t){var i=this;i.$input=i.$container.find(".kv-editable-input"),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$close=i.$container.find(".kv-editable-close"),i.$popover=i.$container.find(".kv-editable-popover"),i.$inline=i.$container.find(".kv-editable-inline"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),e.each(t,function(e,t){i[e]=t}),i.asPopover=1==i.asPopover||"true"===i.asPopover},toggle:function(e,t){var n=this,o=n.$value,r=n.$inline;return t=t||"fast",e?void(n.asPopover||o.fadeOut(t,function(){r.fadeIn(t),".kv-editable-button"===n.target&&i(n.$target,"kv-inline-open")})):void(n.asPopover?n.$popover.popoverX("hide"):r.fadeOut(t,function(){o.fadeIn(t),n.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},listen:function(){var n,o,r=this,a=r.$form,l=r.$btnSubmit,s=r.$btnReset,c=a.parent(),d=r.$container,v=(r.$popover,r.$close),u=".kv-editable-button"===r.target?r.$target:r.$value,f=r.$inline,p=r.$loading,h=r.$input,b=h.closest(".field-"+h.attr("id")),g=h.closest(".kv-editable-parent"),m=b.find(".help-block"),$=r.displayValueConfig,k=a.find('input[name="hasEditable"]'),y="",C="",P=r.$form.data("yiiActiveForm"),E=g.find(".kv-help-block"),j=t(b.attr("class"))||t(m.attr("class"));o=function(n){j?(t(E.attr("class"))&&(E=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(g)),E.html(n)):(m.html(n),i(m,"kv-help-block")),i(g,"has-error"),p.hide(),c.removeClass("kv-editable-processing")},a.on("submit",function(e){e.preventDefault()}).on("keyup",function(e){13===e.which&&r.submitOnEnter&&l.trigger("click")}).on("reset",function(){setTimeout(function(){a.data("kvEditableSubmit",!1),j?(g.find(".help-block").remove(),g.removeClass("has-error")):(b.removeClass("has-error"),m.html(" ")),r.refreshPopover()},200)}),a.find("input, select").on("change",function(){r.refreshPopover(),d.trigger("editableChange",[h.val()])}),s.on("click",function(){k.val(0),setTimeout(function(){a[0].reset()},200),d.trigger("editableReset")}),v.on("click",function(){r.toggle(!1)}),u.on("click",function(){if(r.asPopover)return void r.toggle(!0);var e=!r.$inline.is(":visible");r.toggle(e)}),l.on("click",function(){var l=r.asPopover?c:f;i(l,"kv-editable-processing"),p.show(),k.val(1),a.find(".help-block").each(function(){e(this).html("")}),a.find("input, select").each(function(){e(this).trigger("change")}),n=e.extend({type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",error:function(e,t,i){r.showAjaxErrors&&o(i),d.trigger("editableAjaxError",[e,t,i])},success:function(i){return y="",C=t(i.output)?h.val():i.output,r.refreshPopover(),t(i.message)?(t(E.attr("class"))||(b.removeClass("has-error"),E.html("").hide(),m.html("")),a.find(".help-block").each(function(){var i=e(this).text();y+=i?i.trim():"",t(y)||p.hide()}),t(y)?(p.hide(),t(C)?C=r.valueIfNull:void 0!==$[C]&&(C=$[C]),j?(g.find(".help-block").remove(),g.removeClass("has-error"),m.html(""),r.toggle(!1),r.$value.html(C)):(b.removeClass("has-error"),m.html(""),r.toggle(!1),r.$value.html(C),P&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(P.attributes,P.settings))),d.trigger("editableSuccess",[h.val(),a,i])):d.trigger("editableError",[h.val(),a,i]),void l.removeClass("kv-editable-processing")):(o(i.message),void d.trigger("editableError",[h.val(),a,i]))}},r.ajaxSettings),e.ajax(n),d.trigger("editableSubmit",[h.val(),a])})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),r=o.data("editable"),a="object"==typeof t&&t;r||(r=new n(this,e.extend({},e.fn.editable.defaults,a,e(this).data())),o.data("editable",r)),"string"==typeof t&&r[t].apply(r,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,asPopover:!0},e.fn.editable.Constructor=n}(window.jQuery);