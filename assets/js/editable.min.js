/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.4
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},a=function(t,i){var a=this;a.$container=e(t),a.init(i),a.destroy(),a.create()};a.prototype={constructor:a,init:function(t){var i=this,a=i.$container;i.$input=a.find(".kv-editable-input"),i.$form=a.find(".kv-editable-form"),i.$value=a.find(".kv-editable-value"),i.$close=a.find(".kv-editable-close"),i.$popover=a.find(".kv-editable-popover"),i.$inline=a.find(".kv-editable-inline"),i.$btnSubmit=a.find("button.kv-editable-submit"),i.$btnReset=a.find("button.kv-editable-reset"),i.$loading=a.find(".kv-editable-loading"),i.$target=a.find(t.target),e.each(t,function(e,t){i[e]=t})},htmlEncode:function(t){var i=this;return i.encodeOutput?("object"==typeof t&&e.each(t,function(e,a){t[e]=i.htmlEncode(a)}),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")):t},toggle:function(e,t){var a=this,o=a.$value,n=a.$inline;return t=t||"fast",e?void(a.asPopover||o.fadeOut(t,function(){n.fadeIn(t),".kv-editable-button"===a.target&&i(a.$target,"kv-inline-open")})):void(a.asPopover?a.$popover.popoverX("hide"):n.fadeOut(t,function(){o.fadeIn(t),a.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},raise:function(t,i,a){var o=e.Event(i);return void 0!==a?t.trigger(o,a):t.trigger(o),!o.isDefaultPrevented()},destroy:function(){var e=this,t=".kv-editable-button"===e.target?e.$target:e.$value;e.$form.off(".editable"),e.$form.find("input, select").off(".editable"),e.$close.off(".editable"),e.$btnSubmit.off(".editable"),e.$btnReset.off(".editable"),t.off(".editable")},create:function(){var a,o,n=this,r=n.$form,l=n.$btnSubmit,s=n.$btnReset,d=r.parent(),c=n.$container,u=n.$close,f=n.$inline,v=".kv-editable-button"===n.target?n.$target:n.$value,b=n.$loading,p=n.$input,h="",m="",g=r.data("yiiActiveForm"),$=p.closest(".field-"+p.attr("id")),k=$.find(".help-block"),y=p.closest(".kv-editable-parent"),C=n.displayValueConfig,E=t($.attr("class"))||t(k.attr("class")),P=r.find('input[name="hasEditable"]'),j=y.find(".kv-help-block");a=function(a){E?(t(j.attr("class"))&&(j=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(y)),j.html(a)):(k.html(a),i(k,"kv-help-block")),i(y,"has-error"),b.hide(),d.removeClass("kv-editable-processing")},r.on("submit.editable",function(e){e.preventDefault()}).on("keyup.editable",function(e){13===e.which&&n.submitOnEnter&&n.raise(l,"click.editable")}).on("reset.editable",function(){setTimeout(function(){r.data("kvEditableSubmit",!1),E?(y.find(".help-block").remove(),y.removeClass("has-error")):($.removeClass("has-error"),k.html(" ")),n.refreshPopover()},200)}),r.find("input, select").on("change.editable",function(){n.raise(c,"editableChange",[p.val()])&&n.refreshPopover()}),s.on("click.editable",function(){n.raise(c,"editableReset")&&(P.val(0),setTimeout(function(){r[0].reset()},200))}),u.on("click.editable",function(){n.toggle(!1)}),v.on("click.editable",function(){if(n.asPopover)return void n.toggle(!0);var e=!n.$inline.is(":visible");n.toggle(e)}),l.on("click.editable",function(){var l=n.asPopover?d:f;i(l,"kv-editable-processing"),b.show(),P.val(1),r.find(".help-block").each(function(){e(this).html("")}),r.find(".has-error").removeClass("has-error"),r.find("input, select").each(function(){var t=e(this),i=t.val(),a=i;e.isArray(i)?a.push("-"):a+="-",t.val(a),n.raise(t,"blur"),t.val(i),n.raise(t,"blur")}),o=e.extend({type:r.attr("method"),url:r.attr("action"),data:r.serialize(),dataType:"json",beforeSend:function(e){n.raise(c,"editableBeforeSubmit",[e])||e.abort()},error:function(e,t,i){n.raise(c,"editableAjaxError",[e,t,i])&&n.showAjaxErrors&&a(i)},success:function(i,o,s){return h="",m=t(i.output)?n.htmlEncode(p.val()):i.output,n.refreshPopover(),t(i.message)?(t(j.attr("class"))||($.removeClass("has-error"),j.html("").hide(),k.html("")),r.find(".help-block").each(function(){var i=e(this).text();h+=i?i.trim():"",t(h)||b.hide()}),t(h)?n.raise(c,"editableSuccess",[p.val(),r,i,o,s])&&(b.hide(),t(m)?m=n.valueIfNull:void 0!==C[m]&&(m=C[m]),E?(y.find(".help-block").remove(),y.removeClass("has-error"),k.html(""),n.toggle(!1),n.$value.html(m)):($.removeClass("has-error"),k.html(""),n.toggle(!1),n.$value.html(m),g&&(r.yiiActiveForm("destroy"),r.yiiActiveForm(g.attributes,g.settings)))):n.raise(c,"editableError",[p.val(),r,i]),void l.removeClass("kv-editable-processing")):void(n.raise(c,"editableError",[p.val(),r,i])&&a(i.message))}},n.ajaxSettings),setTimeout(function(){n.raise(c,"editableSubmit",[p.val(),r])&&e.ajax(o)},1e3)})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),n=o.data("editable"),r="object"==typeof t&&t;n||(n=new a(this,e.extend({},e.fn.editable.defaults,r,e(this).data())),o.data("editable",n)),"string"==typeof t&&n[t].apply(n,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,asPopover:!0,encodeOutput:!0},e.fn.editable.Constructor=a}(window.jQuery);