/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.2
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(t,i){this.$container=e(t),this.init(i),this.listen()};i.prototype={constructor:i,init:function(t){var i=this;i.$input=i.$container.find(".kv-editable-input"),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),e.each(t,function(e,t){i[e]=t})},refreshPosition:function(){var t,i=this,a=i.$popover,o=i.placement,r=i.$target,n=a[0].offsetWidth,l=a[0].offsetHeight,s=e.extend({},r.position(),{width:r[0].offsetWidth,height:r[0].offsetHeight});switch(o){case"bottom":t={top:s.top+s.height,left:s.left+s.width/2-n/2};break;case"top":t={top:s.top-l,left:s.left+s.width/2-n/2};break;case"left":t={top:s.top+s.height/2-l/2,left:s.left-n};break;case"right":t={top:s.top+s.height/2-l/2,left:s.left+s.width};break;default:throw"Invalid editable placement '"+o+"'!"}a.css(t)},listen:function(){var i,a,o=this,r=o.$form,n=o.$btnSubmit,l=o.$btnReset,s=r.parent(),d=o.$container,c=o.$popover,h=o.$loading,f=o.$input,u=f.closest(".field-"+f.attr("id")),p=f.closest(".kv-editable-parent"),v=u.find(".help-block"),b=o.displayValueConfig,m=r.find('input[name="hasEditable"]'),g="",k="",$=o.$form.data("yiiActiveForm"),y=p.find(".kv-help-block"),C=t(u.attr("class"))||t(v.attr("class"));a=function(i){C?(t(y.attr("class"))&&(y=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(p)),y.html(i)):v.html(i).removeClass("kv-help-block").addClass("kv-help-block"),p.addClass("has-error"),h.hide(),s.removeClass("kv-editable-processing")},r.on("submit",function(e){e.preventDefault()}).on("keyup",function(t){13===t.which&&o.submitOnEnter&&n.trigger("click")}).on("reset",function(){setTimeout(function(){r.data("kvEditableSubmit",!1),C?(p.find(".help-block").remove(),p.removeClass("has-error")):(u.removeClass("has-error"),v.html(" ")),c.popoverX("refreshPosition")},200)}),r.find("input, select").on("change",function(){c.popoverX("refreshPosition"),d.trigger("editableChange",[f.val()])}),l.on("click",function(){m.val(0),setTimeout(function(){r[0].reset()},200),d.trigger("editableReset")}),n.on("click",function(){s.addClass("kv-editable-processing"),h.show(),m.val(1),r.find("input, select").each(function(){e(this).trigger("change")}),i=e.extend(o.ajaxSettings,{type:r.attr("method"),url:r.attr("action"),data:r.serialize(),dataType:"json",error:function(e,t,i){o.showAjaxErrors&&a(i),d.trigger("editableAjaxError",[e,t,i])},success:function(i){return k=t(i.output)?s.val():i.output,c.popoverX("refreshPosition"),t(i.message)?(t(y.attr("class"))||(u.removeClass("has-error"),y.html("").hide(),v.html("")),r.find(".help-block").each(function(){g=e(this).text(),t(g.trim())||h.hide()}),t(g.trim())?(h.hide(),t(k)?k=o.valueIfNull:void 0!==b[k]&&(k=b[k]),C?(p.find(".help-block").remove(),p.removeClass("has-error"),v.html(""),c.popoverX("hide"),o.$value.html(k)):(u.removeClass("has-error"),v.html(""),c.popoverX("hide"),o.$value.html(k),$&&(r.yiiActiveForm("destroy"),r.yiiActiveForm($.attributes,$.settings))),d.trigger("editableSuccess",[f.val(),r,i])):d.trigger("editableError",[f.val(),r,i]),void s.removeClass("kv-editable-processing")):(a(i.message),void d.trigger("editableError",[f.val(),r,i]))}}),e.ajax(i),d.trigger("editableSubmit",[f.val(),r])})}},e.fn.editable=function(t){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var o=e(this),r=o.data("editable"),n="object"==typeof t&&t;r||(r=new i(this,e.extend({},e.fn.editable.defaults,n,e(this).data())),o.data("editable",r)),"string"==typeof t&&r[t].apply(r,a)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0},e.fn.editable.Constructor=i}(window.jQuery);