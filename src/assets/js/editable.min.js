/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2018
 * @version   1.7.8
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */
!function(e){"use strict";var t,i;t={NAMESPACE:".editable",isEmpty:function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},addCss:function(e,t){e.removeClass(t).addClass(t)},handler:function(e,i,o){var a=i+t.NAMESPACE;e.off(a).on(a,o)},raise:function(t,i,o){var a=e.Event(i);return void 0!==o?t.trigger(a,o):t.trigger(a),!a.isDefaultPrevented()}},i=function(t,i){var o=this;o.$container=e(t),o.init(i),o.destroy(),o.create()},i.prototype={constructor:i,init:function(t){var i=this,o=i.$container;i.$input=o.find(".kv-editable-input"),i.$form=o.find(".kv-editable-form"),i.$value=o.find(".kv-editable-value"),i.$close=o.find(".kv-editable-close"),i.$popover=o.find(".kv-editable-popover"),i.$inline=o.find(".kv-editable-inline"),i.$btnSubmit=o.find("button.kv-editable-submit"),i.$btnReset=o.find("button.kv-editable-reset"),i.$loading=o.find(".kv-editable-loading"),i.$target=o.find(t.target),e.each(t,function(e,t){i[e]=t}),i.$targetEl=".kv-editable-button"===i.target?i.$target:i.$value,i.initActions()},initActions:function(){var i,o=this,a=o.$form,r=a.parent(),n=o.$container,l=o.$inline,s=o.$loading,c=o.$input,u="",d="",f=a.data("yiiActiveForm"),p=c.closest(".field-"+c.attr("id")),v=p.find(".help-block"),m=c.closest(".kv-editable-parent"),h=o.displayValueConfig,b=a.find('input[name="hasEditable"]'),g=t.isEmpty(p.attr("class"))||t.isEmpty(v.attr("class")),y=m.find(".kv-help-block");i=function(i){g?(y.length||(y=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(m)),y.html(i).show()):(t.addCss(v,"kv-help-block"),v.html(i).show()),t.addCss(m,"has-error"),s.hide(),r.removeClass("kv-editable-processing")},o.actions={formReset:function(){setTimeout(function(){a.data("kvEditableSubmit",!1),g?(m.find(".help-block").remove(),m.removeClass("has-error")):(p.removeClass("has-error"),v.html(" ")),o.refreshPopover()},o.resetDelay)},formSubmit:function(e){e.preventDefault()},formChange:function(){t.raise(n,"editableChange",[c.val()])&&o.refreshPopover()},formKeyup:function(e){13===e.which&&o.submitOnEnter&&(o.submitFlag=!0,o.actions.submitClick())},formBlur:function(e){var t=e.delegateTarget;setTimeout(function(){t.contains(document.activeElement)||o.submitFlag||!o.closeOnBlur||o.toggle(!1)},0)},inlineKeyup:function(e){27===e.which&&o.actions.closeClick()},closeClick:function(){o.toggle(!1)},targetClick:function(){var e;return o.submitFlag=!1,o.asPopover?void o.toggle(!0):(e=!l.is(":visible"),void o.toggle(e))},resetClick:function(){t.raise(n,"editableReset")&&(b.val(0),setTimeout(function(){a[0].reset()},o.resetDelay))},submitClick:function(){var E,k=o.asPopover?r:l,$=!1;t.addCss(k,"kv-editable-processing"),s.show(),b.val(1),a.find(".help-block").each(function(){e(this).html("")}),a.find(".has-error").removeClass("has-error"),a.find("input, select").each(function(){var i=e(this),o=i.val(),a=o,r="file"===i.attr("type");$||($=r),i.attr("disabled")||(r?t.raise(i,"blur"):(e.isArray(o)?a.push("-"):a+="-",i.val(a),t.raise(i,"blur"),i.val(o),t.raise(i,"blur")))}),E={type:a.attr("method"),url:a.attr("action"),dataType:"json",beforeSend:function(e){t.raise(n,"editableBeforeSubmit",[e])||e.abort()},error:function(e,a,r){t.raise(n,"editableAjaxError",[e,a,r])&&o.showAjaxErrors&&i(r)},success:function(r,l,b){return u="",d=t.isEmpty(r.output)?o.htmlEncode(c.val()):r.output,o.refreshPopover(),t.isEmpty(r.message)?(t.isEmpty(y.attr("class"))||(p.removeClass("has-error"),y.html("").hide(),v.html("")),a.find(".help-block").each(function(){var i=e(this).text();u+=i?i.trim():"",t.isEmpty(u)||s.hide()}),t.isEmpty(u)?t.raise(n,"editableSuccess",[c.val(),a,r,l,b])&&(s.hide(),t.isEmpty(d)?d=o.valueIfNull:void 0!==h[d]&&(d=h[d]),g?(m.find(".help-block").remove(),m.removeClass("has-error"),v.html(""),o.toggle(!1),o.$value.html(d)):(p.removeClass("has-error"),v.html(""),o.toggle(!1),o.$value.html(d),f&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(f.attributes,f.settings)))):t.raise(n,"editableError",[c.val(),a,r]),void k.removeClass("kv-editable-processing")):void(t.raise(n,"editableError",[c.val(),a,r])&&i(r.message))}},$&&window.FormData?(a.attr("enctype","multipart/form-data"),E.data=new FormData(a[0]),E.contentType=!1,E.processData=!1,E.cache=!1):E.data=a.serialize(),setTimeout(function(){t.raise(n,"editableSubmit",[c.val(),a])&&e.ajax(e.extend(!0,E,o.ajaxSettings))},o.validationDelay)}}},htmlEncode:function(t){var i=this;return i.encodeOutput?"object"==typeof t?(e.each(t,function(e,o){t[e]=i.htmlEncode(o)}),t):("string"==typeof t&&(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")),t):t},toggle:function(e){var i=this,o=i.$value,a=i.$inline,r=i.animationDelay,n=function(){i.$btnSubmit.focus(),i.selectAllOnEdit&&i.$input.select()};return e?i.asPopover?void n():void o.fadeOut(r,function(){a.fadeIn(r,function(){n()}),".kv-editable-button"===i.target&&t.addCss(i.$target,"kv-inline-open")}):void(i.asPopover?i.$popover.popoverX("hide"):a.fadeOut(r,function(){o.fadeIn(r),i.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},destroy:function(){var e=this;e.$form.off(t.NAMESPACE),e.$form.find("input, select").off(t.NAMESPACE),e.$close.off(t.NAMESPACE),e.$inline.off(t.NAMESPACE),e.$popover.off(t.NAMESPACE),e.$btnSubmit.off(t.NAMESPACE),e.$btnReset.off(t.NAMESPACE),e.$targetEl.off(t.NAMESPACE)},create:function(){var i=this,o=i.actions,a=i.$form,r=i.$inline;t.handler(a,"reset",e.proxy(o.formReset,i)),t.handler(a,"submit",e.proxy(o.formSubmit,i)),t.handler(a.find("input, select"),"change",e.proxy(o.formChange,i)),t.handler(a,"keyup",e.proxy(o.formKeyup,i)),i.asPopover?t.handler(i.$popover,"focusout",e.proxy(o.formBlur,i)):(t.handler(r,"keyup",e.proxy(o.inlineKeyup,i)),t.handler(r,"focusout",e.proxy(o.formBlur,i))),t.handler(i.$btnReset,"click",e.proxy(o.resetClick,i)),t.handler(i.$btnSubmit,"click",e.proxy(o.submitClick,i)),t.handler(i.$close,"click",e.proxy(o.closeClick,i)),t.handler(i.$targetEl,"click",e.proxy(o.targetClick,i))}},e.fn.editable=function(t){var o=Array.apply(null,arguments);return o.shift(),this.each(function(){var a=e(this),r=a.data("editable"),n="object"==typeof t&&t;r||(r=new i(this,e.extend({},e.fn.editable.defaults,n,e(this).data())),a.data("editable",r)),"string"==typeof t&&r[t].apply(r,o)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,selectAllOnEdit:!0,asPopover:!0,encodeOutput:!0,closeOnBlur:!0,validationDelay:500,resetDelay:200,animationDelay:300},e.fn.editable.Constructor=i}(window.jQuery);
